<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
body{
 margin:0;
 display:flex;
 height:100vh;
 font-family:sans-serif;
 background:#f6f1e7;
}

/* ===== ì¢Œì¸¡ ===== */
#left{flex:8;display:flex;flex-direction:column}

.tabs{
 display:flex;
 height:36px;
 background:#e8dcc8;
 border-bottom:1px solid #c9bda8;
}
.tab{
 flex:1;
 display:flex;
 align-items:center;
 justify-content:center;
 cursor:pointer;
 font-size:14px;
}
.tab.active{background:#fffdf7;font-weight:bold}

#imageArea{
 flex:1;
 position:relative;
 background:#e9e2d6;
 touch-action:none;
}
#canvas{
 width:100%;height:100%;
 background-size:contain;
 background-position:center;
 background-repeat:no-repeat;
}

/* ===== í•­ëª© ===== */
.hit{
 position:absolute;
 transform:translate(-50%,-50%);
 background:#fffdf7;
 border:1px solid #9c8f7a;
 padding:6px 10px;
 border-radius:12px;
 cursor:pointer;
}

/* ğŸ‘‰ ë§í’ì„  í™”ì‚´í‘œ */
.hit::after{
 content:"";
 position:absolute;
 bottom:-6px;
 left:14px;
 width:10px;height:10px;
 background:#fffdf7;
 border-left:1px solid #9c8f7a;
 border-bottom:1px solid #9c8f7a;
 transform:rotate(45deg);
}

.hit.active{background:#ffe9a8}

/* ===== ìš°ì¸¡ ===== */
#side{
 flex:2;
 border-left:1px solid #c9bda8;
 display:flex;
 flex-direction:column;
 background:#fffdf7;
}

#search{
 padding:8px;
 border:none;
 border-bottom:1px solid #ddd;
 background:#fffaf0;
}

ul{list-style:none;margin:0;padding:0;flex:1;overflow:auto}
li{padding:8px;border-bottom:1px solid #eee;cursor:pointer}
li.active{background:#f3e6c8}

.detail{font-size:13px;display:none;margin-top:4px}
.del{float:right;color:#c97b7b;cursor:pointer}

/* ===== í•˜ë‹¨ë°” ===== */
#bar{
 position:fixed;
 bottom:10px;
 left:10px;
 background:#fffdf7;
 padding:8px;
 border-radius:12px;
 box-shadow:0 2px 6px rgba(0,0,0,.15);
}
button{
 margin:2px;
 background:#f3d8e2;
 border:none;
 padding:6px 10px;
 border-radius:8px;
 cursor:pointer;
}
.edit-on{background:#a8d8c9}
</style>
</head>

<body>

<div id="left">
 <div class="tabs">
  <div id="tabMy" class="tab active">ë‚´ ì‘ì—…</div>
  <div id="tabTpl" class="tab">í…œí”Œë¦¿</div>
 </div>

 <div id="imageArea">
  <div id="canvas"></div>
  <div id="hits"></div>
 </div>
</div>

<div id="side">
 <input id="search" placeholder="ê²€ìƒ‰...">
 <ul id="list"></ul>
</div>

<div id="bar">
 <button id="editBtn">í¸ì§‘</button>
 <button id="bgBtn">ë°°ê²½</button>
 <button id="pngBtn">PNG</button>
 <button id="jsonOut">JSONâ†“</button>
 <button id="jsonIn">JSONâ†‘</button>

 <input type="file" id="bgInput" hidden accept="image/*">
 <input type="file" id="jsonFile" hidden accept=".json">
</div>

<script>
let myData=JSON.parse(localStorage.getItem("myData")||"[]");
let tplData=[];
let items=myData;

let edit=false;
let selected=null;
let mode="my";
let searchText="";
let dragging=null;

/* ===== ìš”ì†Œ ===== */
const imageArea=document.getElementById("imageArea"); /* ğŸ”¥ ë³µêµ¬ í•µì‹¬ */
const hits=document.getElementById("hits");
const list=document.getElementById("list");
const canvas=document.getElementById("canvas");
const search=document.getElementById("search");

const editBtn=document.getElementById("editBtn");
const bgBtn=document.getElementById("bgBtn");
const pngBtn=document.getElementById("pngBtn");
const jsonOut=document.getElementById("jsonOut");
const jsonIn=document.getElementById("jsonIn");

const bgInput=document.getElementById("bgInput");
const jsonFile=document.getElementById("jsonFile");

/* ===== ë“œë˜ê·¸ (íœìŠ¬/í„°ì¹˜ ì§€ì›) ===== */
function startDrag(e,it){
 if(!edit||mode!=="my")return;
 dragging=it;
}
function moveDrag(e){
 if(!dragging)return;
 let t=e.touches?e.touches[0]:e;
 const r=imageArea.getBoundingClientRect();
 dragging.x=(t.clientX-r.left)/r.width*100;
 dragging.y=(t.clientY-r.top)/r.height*100;
 save();render();
}
function endDrag(){dragging=null;}

document.addEventListener("pointermove",moveDrag);
document.addEventListener("pointerup",endDrag);

/* ===== í¸ì§‘ ===== */
editBtn.onclick=()=>{
 edit=!edit;
 editBtn.classList.toggle("edit-on",edit);
};

/* ===== ë°°ê²½ ===== */
bgBtn.onclick=()=>{ if(edit) bgInput.click(); };

bgInput.onchange=e=>{
 const f=e.target.files[0];
 const r=new FileReader();
 r.onload=()=>{
  canvas.style.backgroundImage=`url(${r.result})`;
  localStorage.setItem("bg",r.result);
 };
 r.readAsDataURL(f);
};

const bg=localStorage.getItem("bg");
if(bg) canvas.style.backgroundImage=`url(${bg})`;

/* ===== ì¶”ê°€ ===== */
imageArea.ondblclick=e=>{
 if(!edit||mode!=="my")return;
 const r=imageArea.getBoundingClientRect();
 myData.push({
  id:Date.now(),
  name:"í•­ëª©",
  desc:"ì„¤ëª…",
  x:(e.clientX-r.left)/r.width*100,
  y:(e.clientY-r.top)/r.height*100
 });
 save(); render();
};

/* ===== ì €ì¥ ===== */
function save(){
 localStorage.setItem("myData",JSON.stringify(myData));
}

/* ===== ë Œë” ===== */
function render(){
 hits.innerHTML="";
 list.innerHTML="";

 items.forEach(it=>{
  const d=document.createElement("div");
  d.className="hit"+(it.id===selected?" active":"");
  d.style.left=it.x+"%";
  d.style.top=it.y+"%";
  d.textContent=it.name;

  d.onpointerdown=e=>startDrag(e,it);

  d.onclick=e=>{
   e.stopPropagation();
   selected=it.id;
   render();
  };

  hits.appendChild(d);
 });
}

render();
</script>

</body>
</html>